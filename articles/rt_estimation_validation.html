<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Validation of time-varying reproduction number estimation • mitey</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Validation of time-varying reproduction number estimation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mitey</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/code_validation_for_Vink_method.html">Code validation for Vink method</a></li>
    <li><a class="dropdown-item" href="../articles/epidemiology_of_scabies.html">Estimation of the epidemiological characteristics of scabies</a></li>
    <li><a class="dropdown-item" href="../articles/reproduce_results_ainslie_et_al.html">Reproduce Results from Ainslie et al.</a></li>
    <li><a class="dropdown-item" href="../articles/rt_estimation_validation.html">Validation of time-varying reproduction number estimation</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kylieainslie/mitey/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Validation of time-varying reproduction number estimation</h1>
                        <h4 data-toc-skip class="author">Kylie
Ainslie</h4>
            
            <h4 data-toc-skip class="date">2025-02-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/kylieainslie/mitey/blob/main/vignettes/articles/rt_estimation_validation.Rmd" class="external-link"><code>vignettes/articles/rt_estimation_validation.Rmd</code></a></small>
      <div class="d-none name"><code>rt_estimation_validation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>mitey</code> package is a lightweight package designed to
provide easy implementation of the methods used in <a href="https://kylieainslie.github.io/mitey/articles/epidemiology_of_scabies.html">Ainslie
et al. 2024</a> to estimate epidemiological characteristics of scabies
transmission. However, these methods are more widely applicable than in
the context of scabies. One of the key functionalities of
<code>mitey</code> is the estimation of the time-varying case
reproduction number using data on time of symptom onset. The case
reproduction number
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>R</mi><mi>t</mi><mi>c</mi></msubsup><annotation encoding="application/x-tex">R^c_t</annotation></semantics></math>)
is defined as the average number of new infections that an individual
who becomes infected, or symptomatic, at a particular time point will go
on to cause<span class="citation"><sup>1</sup></span>, and is useful in
retrospective analyses. The method of Wallinga and Lipsitch estimates
the time-varying case reproduction number by determining the likelihood
of an event occurring for every pair of time points<span class="citation"><sup>2</sup></span>. The method requires no assumptions
beyond the specification of the serial interval distribution, making it
straightforward and easy to implement.</p>
<p>In this article, we will demonstrate how to use <code>mitey</code> to
estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>R</mi><mi>t</mi><mi>c</mi></msubsup><annotation encoding="application/x-tex">R^c_t</annotation></semantics></math>
using a synthetic data set and real data. We will also compare the
estimates from <code>mitey</code> to estimates from other R packages
that can be used for similar analyses, namely <code>EpiEstim</code><span class="citation"><sup>3</sup></span> and <code>EpiLPS</code><span class="citation"><sup>4</sup></span>.</p>
</div>
<div class="section level2">
<h2 id="synthetic-data">Synthetic data<a class="anchor" aria-label="anchor" href="#synthetic-data"></a>
</h2>
<p>First, we will generate a synthetic time series of incidence data
using the <code>episim()</code> function from <code>EpiLPS</code> which
uses a renewal equation model to generate the case incidence data based
on a Poisson or negative binomial process<span class="citation"><sup>4</sup></span>. For full details see <a href="https://doi.org/10.1371/journal.pcbi.1010618.s002" class="external-link">here</a>.
<code>episim()</code> requires the specification of the (discrete)
serial interval distribution, which can be specified using the
<code>Idist()</code> function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify serial interval distribution</span></span>
<span><span class="va">mean_si</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span><span class="va">sd_si</span> <span class="op">&lt;-</span> <span class="fl">5.66</span></span>
<span></span>
<span><span class="co"># generate discrete serial interval distribution using EpiLPS::Idist</span></span>
<span><span class="va">si_spec</span> <span class="op">&lt;-</span> <span class="fu">Idist</span><span class="op">(</span>mean <span class="op">=</span> <span class="va">mean_si</span>, sd <span class="op">=</span> <span class="va">sd_si</span>, dist <span class="op">=</span> <span class="st">"gamma"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">si_spec</span>, titlesize <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<p><img src="rt_estimation_validation_files/figure-html/generate_si_dist-1.png" width="700"></p>
<p>Now, using <code>episim()</code> we can generate incidence data by
specifying the generated serial interval distribution, the functional
form of the reproduction number (here <code>Rpattern = 5</code>), and
the length of the epidemic (here 40 days).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate data</span></span>
<span><span class="va">t_end</span> <span class="op">&lt;-</span> <span class="fl">40</span></span>
<span><span class="va">datasim</span> <span class="op">&lt;-</span> <span class="fu">episim</span><span class="op">(</span>si <span class="op">=</span> <span class="va">si_spec</span><span class="op">$</span><span class="va">pvec</span>, Rpattern <span class="op">=</span> <span class="fl">5</span>, endepi <span class="op">=</span> <span class="va">t_end</span>,</span>
<span>                  dist <span class="op">=</span> <span class="st">"negbin"</span>, overdisp <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">epicurve</span><span class="op">(</span><span class="va">datasim</span><span class="op">$</span><span class="va">y</span>, title <span class="op">=</span> <span class="st">"Simulated epidemic curve"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rt_estimation_validation_files/figure-html/simulate_inc_data-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="estimating-the-case-reproduction-number">Estimating the case reproduction number<a class="anchor" aria-label="anchor" href="#estimating-the-case-reproduction-number"></a>
</h2>
<p>Next, using the simulated incidence data <code>datasim$y</code>, we
can estimate the time-varying case reproduction number using the method
developed by Wallinga and Lipsitch<span class="citation"><sup>2</sup></span>. We will use the
<code><a href="../reference/rt_estim.html">rt_estim()</a></code> function within <code>mitey</code>.
<code><a href="../reference/rt_estim.html">rt_estim()</a></code> expects an input data set (<code>inc_dat</code>)
with two columns <code>inc</code> (the number of new cases for each time
point) and <code>onset_date</code> (the time or date in which the new
cases occurred). <code><a href="../reference/rt_estim.html">rt_estim()</a></code> also requires the specification
of the mean and standard deviation of the serial interval distribution
and the underlying serial interval distribution (it currently only
accepts “normal” and “gamma”).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate Rt with mitey::rt_estim()</span></span>
<span></span>
<span><span class="va">t_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">datasim</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">inc_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>onset_date <span class="op">=</span> <span class="va">t_vec</span>, inc <span class="op">=</span> <span class="va">datasim</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rt_estimated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rt_estim.html">rt_estim</a></span><span class="op">(</span></span>
<span>  inc_dat <span class="op">=</span> <span class="va">inc_dat</span>,</span>
<span>  mean_si <span class="op">=</span> <span class="va">mean_si</span>,</span>
<span>  sd_si <span class="op">=</span> <span class="va">sd_si</span>,</span>
<span>  dist_si <span class="op">=</span> <span class="st">"gamma"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;   onset_date         rt rt_adjusted</span></span>
<span><span class="co">#&gt; 1          1        Inf         Inf</span></span>
<span><span class="co">#&gt; 2          2 35.4390029  35.4390049</span></span>
<span><span class="co">#&gt; 3          3        NaN         NaN</span></span>
<span><span class="co">#&gt; 4          4  2.4083146   2.4083155</span></span>
<span><span class="co">#&gt; 5          5  0.9028469   0.9028477</span></span>
<span><span class="co">#&gt; 6          6  3.5467368   3.5467445</span></span></code></pre>
<p>Now, we can compare the estimated
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>R</mi><mi>t</mi><mi>c</mi></msubsup><annotation encoding="application/x-tex">R^c_t</annotation></semantics></math>
values (solid blue line) to the true
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
that is outputted by <code>episim()</code>, here
<code>datasim$Rtrue</code>. However, an important thing to note is that
the “true”
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
is the instantaneous reproduction number. We are estimating the case
reproduction number, and therefore, our estimates should be shifted to
the left by one serial interval. When we shift the estimates by a serial
interval (blue dashed line), we see that our estimates are in agreement
with the true
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>.</p>
<p><img src="rt_estimation_validation_files/figure-html/plot_results-1.png" width="700"></p>
<p>To obtain confidence bounds for our estimated
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
values, we can use <code><a href="../reference/rt_estim_w_boot.html">rt_estim_w_boot()</a></code> and specify the number
of bootstrap samples using <code>n_bootstrap =</code> argument.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rt_estimated_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rt_estim_w_boot.html">rt_estim_w_boot</a></span><span class="op">(</span></span>
<span>  inc_dat <span class="op">=</span> <span class="va">inc_dat</span>,</span>
<span>  mean_si <span class="op">=</span> <span class="va">gi_mean</span>,</span>
<span>  sd_si <span class="op">=</span> <span class="va">gi_sd</span>,</span>
<span>  dist_si <span class="op">=</span> <span class="st">"gamma"</span>,</span>
<span>  n_bootstrap <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="comparing-methods">Comparing methods<a class="anchor" aria-label="anchor" href="#comparing-methods"></a>
</h2>
<p>Using the <code>estimRmcmc</code> function within the
<code>EpiLPS</code> package, we can compare our estimates to those
produced my <code>EpiLPS</code> and <code>EpiEstim</code> (by specifying
<code>Cori = TRUE</code>) for estimating the instantaneous reproduction
number. We can also estimate the case reproduction number using the
method of Wallinga and Teunis<span class="citation"><sup><strong>wallinga2004?</strong></sup></span> as
estimated by <code>EpiEstim</code> (by specifying
<code>WTR = TRUE</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitmcmc</span> <span class="op">&lt;-</span> <span class="fu">estimRmcmc</span><span class="op">(</span>incidence <span class="op">=</span> <span class="va">datasim</span><span class="op">$</span><span class="va">y</span>, si <span class="op">=</span> <span class="va">si_spec</span><span class="op">$</span><span class="va">pvec</span>,</span>
<span>                      CoriR <span class="op">=</span> <span class="cn">TRUE</span>, WTR <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                      niter <span class="op">=</span> <span class="fl">5000</span>, burnin <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitmcmc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimation of the reproduction number with Laplacian-P-splines </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------- </span></span>
<span><span class="co">#&gt; Total number of days:          40 </span></span>
<span><span class="co">#&gt; Routine time (seconds):        3.075 </span></span>
<span><span class="co">#&gt; Method:                        MCMC (with Langevin diffusion) </span></span>
<span><span class="co">#&gt; Hyperparam. optim method:      Nelder-Mead </span></span>
<span><span class="co">#&gt; Hyperparam. optim convergence: TRUE </span></span>
<span><span class="co">#&gt; Mean reproduction number:      1.400 </span></span>
<span><span class="co">#&gt; Min  reproduction number:      0.350 </span></span>
<span><span class="co">#&gt; Max  reproduction number:      3.555 </span></span>
<span><span class="co">#&gt; --------------------------------------------------------------</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tt</span>, <span class="va">Rtrue</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="st">"R"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span>,</span>
<span>     lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">tt</span>, <span class="va">fitmcmc</span><span class="op">$</span><span class="va">RLPS</span><span class="op">$</span><span class="va">R</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">mean_si</span><span class="op">)</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">tt</span>, <span class="va">fitmcmc</span><span class="op">$</span><span class="va">RCori</span><span class="op">$</span><span class="va">`Mean(R)`</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"green"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">tt</span>, <span class="va">fitmcmc</span><span class="op">$</span><span class="va">RWT</span><span class="op">$</span><span class="va">`Mean(R)`</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"purple"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">tt</span>, <span class="va">rt_WL_smooth</span><span class="op">[</span><span class="va">tt</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">tt</span>, <span class="va">rt_WL_shift</span><span class="op">[</span><span class="va">tt</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"red"</span>,<span class="st">"green"</span>, <span class="st">"purple"</span>, <span class="st">"blue"</span>, <span class="st">"blue"</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"True R"</span>,<span class="st">"EpiLPS"</span>,<span class="st">"EpiEstim"</span>, <span class="st">"WT"</span>, <span class="st">"WL"</span>, <span class="st">"WL (shifted)"</span><span class="op">)</span>,</span>
<span>       bty <span class="op">=</span> <span class="st">"n"</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="rt_estimation_validation_files/figure-html/plot_comparison_methods-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="real-data">Real data<a class="anchor" aria-label="anchor" href="#real-data"></a>
</h2>
<div class="section level3">
<h3 id="zika-outbreak-in-giradot-colombia-2015">Zika outbreak in Giradot, Colombia (2015)<a class="anchor" aria-label="anchor" href="#zika-outbreak-in-giradot-colombia-2015"></a>
</h3>
<p>To illustrate how to apply <code><a href="../reference/rt_estim.html">rt_estim()</a></code> to real data and
compare it to other methods, we’ll use data on daily incidence of the
Zika virus disease in Giradot, Colombia from October 2015 to January
2016. The data is available from the <code>outbreaks</code> package and
is called <code>zika2015</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">zika2015</span>, <span class="va">head</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; $incidence</span></span>
<span><span class="co">#&gt;  [1] 1 2 1 4 2 5 2 4 5 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dates</span></span>
<span><span class="co">#&gt;  [1] "2015-10-19" "2015-10-22" "2015-10-23" "2015-10-24" "2015-10-25"</span></span>
<span><span class="co">#&gt;  [6] "2015-10-26" "2015-10-27" "2015-10-28" "2015-10-29" "2015-10-30"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $si</span></span>
<span><span class="co">#&gt;  [1] 7.771909e-09 2.813233e-05 2.333550e-03 3.004073e-02 1.241007e-01</span></span>
<span><span class="co">#&gt;  [6] 2.372892e-01 2.605994e-01 1.887516e-01 9.898834e-02 4.014149e-02</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zika_epicurve</span> <span class="op">&lt;-</span> <span class="fu">epicurve</span><span class="op">(</span><span class="va">zika2015</span><span class="op">$</span><span class="va">incidence</span>, dates <span class="op">=</span> <span class="va">zika2015</span><span class="op">$</span><span class="va">date</span>, datelab <span class="op">=</span> <span class="st">"14d"</span><span class="op">)</span></span>
<span><span class="va">zika_epicurve</span></span></code></pre></div>
<p><img src="rt_estimation_validation_files/figure-html/zika_epicurve-1.png" width="700"></p>
<p>Now we’ll estimate the case reproduction number using
<code><a href="../reference/rt_estim.html">rt_estim()</a></code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate Rt with mitey::rt_estim()</span></span>
<span><span class="va">inc_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>onset_date <span class="op">=</span> <span class="va">zika2015</span><span class="op">$</span><span class="va">dates</span>, inc <span class="op">=</span> <span class="va">zika2015</span><span class="op">$</span><span class="va">incidence</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rt_estimated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rt_estim_w_boot.html">rt_estim_w_boot</a></span><span class="op">(</span></span>
<span>  inc_dat <span class="op">=</span> <span class="va">inc_dat</span>,</span>
<span>  mean_si <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  sd_si <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  dist_si <span class="op">=</span> <span class="st">"gamma"</span>,</span>
<span>  n_bootstrap <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the plot</span></span>
<span><span class="va">r_plot</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">rt_estimated</span><span class="op">$</span><span class="va">results</span> <span class="op">%&gt;%</span></span>
<span>         <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">onset_date</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">onset_date</span><span class="op">)</span> <span class="op">+</span> <span class="fl">7</span>,</span>
<span>                <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">median_rt_adjusted</span><span class="op">)</span><span class="op">)</span>, </span>
<span>       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">onset_date</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_ribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower_rt_adjusted</span>, ymax <span class="op">=</span> <span class="va">upper_rt_adjusted</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"#21908C"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">median_rt_adjusted</span>, color <span class="op">=</span> <span class="st">"WL"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"7 days"</span>, date_labels <span class="op">=</span> <span class="st">"%d-%m-%Y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WL"</span> <span class="op">=</span> <span class="st">"#21908C"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WL"</span> <span class="op">=</span> <span class="st">"#21908C"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"R"</span>, title <span class="op">=</span> <span class="st">"Estimated R"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span>, fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span></span>
<span><span class="co"># show Rt plot with epicurve</span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">zika_epicurve</span>, <span class="va">r_plot</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="rt_estimation_validation_files/figure-html/plot-1.png" width="700"></p>
<div class="section level4">
<h4 id="compare-with-epilps-and-epiestim">Compare with EpiLPS and EpiEstim<a class="anchor" aria-label="anchor" href="#compare-with-epilps-and-epiestim"></a>
</h4>
<p>Below we compare the estimates using the Walling and Lipsitch method
(WL) with those of <code>EpiLPS</code> and the Wallinga and Teunis
method (WT) produced by <code>EpiEstim</code>. We see similar results
and see the expected shif in the estimates of EpiLPS because it is
estimating the instantaneous reproduction number. Additionally, it is
important to note that the below WL estimates have not been
smoothed.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">si</span> <span class="op">&lt;-</span> <span class="fu">Idist</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">7</span>, sd <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">epifit</span> <span class="op">&lt;-</span> <span class="fu">estimR</span><span class="op">(</span><span class="va">zika2015</span><span class="op">$</span><span class="va">incidence</span>, dates <span class="op">=</span> <span class="va">zika2015</span><span class="op">$</span><span class="va">dates</span>, si <span class="op">=</span> <span class="va">si</span><span class="op">$</span><span class="va">pvec</span>, WTR <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">epifit</span><span class="op">$</span><span class="va">RLPS</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span>,<span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">R</span>, color <span class="op">=</span> <span class="st">"EpiLPS"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">epifit</span><span class="op">$</span><span class="va">RWT</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">t_end</span> <span class="op">+</span> <span class="va">zika2015</span><span class="op">$</span><span class="va">dates</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">`Mean(R)`</span>, color <span class="op">=</span> <span class="st">"WT (EpiEstim)"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WL"</span> <span class="op">=</span> <span class="st">"#21908C"</span>, <span class="st">"EpiLPS"</span> <span class="op">=</span> <span class="st">"#FDE725"</span>, <span class="st">"WT (EpiEstim)"</span> <span class="op">=</span> <span class="st">"#440154"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Method"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Scale for <span style="color: #00BB00;">colour</span> is already present.</span></span>
<span><span class="co">#&gt; Adding another scale for <span style="color: #00BB00;">colour</span>, which will replace the existing scale.</span></span></code></pre></div>
<p><img src="rt_estimation_validation_files/figure-html/use_epilps-1.png" width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<!-- # Checks  -->
<!-- To sense-check estimates of the reproduction number from real data, there are a couple of strategies : -->
<!--   1. Growth rate method: calculate $R_t = b(t+u)/b(t)$ where $b()$ is the incidence, t is the current time point, and u is the mean generation time (here, approximated with the mean serial interval). -->
<!-- ```{r rt_growth_rate_method, eval=FALSE} -->
<!--   # 1. Calculate b(t+u)/b(t) where b() is the incidence, t is the current time -->
<!-- #    point, and u is the mean SI -->
<!-- seq1 <- 1:(nrow(df_real)) -->
<!-- seq2 <- seq1 + 123 -->
<!-- rt_check1 <- data.frame( -->
<!--   onset_date = (seq1 - 1) + min(df$onset_date), -->
<!--   rt_check1 = df_real$inc[seq2]/df_real$inc[seq1] -->
<!-- )  -->
<!-- ``` -->
<!--   2. Calculate the geometric mean of the time series of time-varying reproduction number. The geometric mean should be ~$R_0$. -->
<!-- ```{r rt_geom_mean, eval=FALSE}   -->
<!-- # 2. Calculate geometric mean -->
<!-- # This should be approx R0 = 1.1 -->
<!-- rt_check2 <- exp(mean(log(rt_estimates1$rt), na.rm = TRUE)) -->
<!-- rt_check2 -->
<!-- ```   -->
<div id="refs" class="references csl-bib-body" entry-spacing="0" line-spacing="2">
<div id="ref-gostic2020" class="csl-entry">
<div class="csl-left-margin">1. </div>
<div class="csl-right-inline">Gostic, K. M. <em>et al.</em> Practical
considerations for measuring the effective reproductive number, rt.
<em>PLoS Comput. Biol.</em> <strong>16</strong>, e1008409 (2020).</div>
</div>
<div id="ref-wallinga2007" class="csl-entry">
<div class="csl-left-margin">2. </div>
<div class="csl-right-inline">Wallinga, J. &amp; Lipsitch, M. How generation
intervals shape the relationship between growth rates and reproductive
numbers. <em>Proc. Biol. Sci.</em> <strong>274</strong>, 599–604
(2007).</div>
</div>
<div id="ref-cori2013" class="csl-entry">
<div class="csl-left-margin">3. </div>
<div class="csl-right-inline">Cori, A., Ferguson, N. M., Fraser, C. &amp;
Cauchemez, S. A new framework and software to estimate time-varying
reproduction numbers during epidemics. <em>Am. J. Epidemiol.</em>
<strong>178</strong>, 1505–1512 (2013).</div>
</div>
<div id="ref-gressani2022" class="csl-entry">
<div class="csl-left-margin">4. </div>
<div class="csl-right-inline">Gressani, O., Wallinga, J., Althaus, C. L.,
Hens, N. &amp; Faes, C. <span>EpiLPS</span>: A fast and flexible
bayesian tool for estimation of the time-varying reproduction number.
<em>PLoS Comput. Biol.</em> <strong>18</strong>, e1010618 (2022).</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kylie Ainslie.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
