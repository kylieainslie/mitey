<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Validation of time-varying reproduction number estimation • mitey</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Validation of time-varying reproduction number estimation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mitey</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/code_validation_for_Vink_method.html">Code validation for Vink method</a></li>
    <li><a class="dropdown-item" href="../articles/epidemiology_of_scabies.html">Estimation of epidemiological characteristics of scabies</a></li>
    <li><a class="dropdown-item" href="../articles/rt_estimation_validation.html">Validation of time-varying reproduction number estimation</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kylieainslie/mitey/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Validation of time-varying reproduction number estimation</h1>
                        <h4 data-toc-skip class="author">Kylie
Ainslie</h4>
            
            <h4 data-toc-skip class="date">2025-01-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/kylieainslie/mitey/blob/main/vignettes/articles/rt_estimation_validation.Rmd" class="external-link"><code>vignettes/articles/rt_estimation_validation.Rmd</code></a></small>
      <div class="d-none name"><code>rt_estimation_validation.Rmd</code></div>
    </div>

    
    
<p><strong>This article is still under development!</strong></p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>mitey</code> package is a lightweight package designed as a
companion to the analyses presented by Ainsie et al. on scabies
transmission. However, these methods are more widely applicable than in
the context of scabies. One of the key functionalities of
<code>mitey</code> is the estimation of the time-varying case
reproduction number using data on time of symptom onset. The case
reproduction number
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>R</mi><mi>t</mi><mi>c</mi></msubsup><annotation encoding="application/x-tex">R^c_t</annotation></semantics></math>)
is defined as the average number of new infections that an individual
who becomes infected, or symptomatic, at a particular time point will go
on to cause<span class="citation"><sup><strong>gostic2020?</strong></sup></span>, and is
useful in retrospective analyses. The method of Wallinga and Teunis
estimates the time-varying case reproduction number by determining the
likelihood of an event occurring for every pair of time points<span class="citation"><sup><strong>wallinga2007?</strong></sup></span>. The
method requires the specification of the serial interval distribution.
In this article, we will demonstrate how to use <code>mitey</code> to
estimate the case reproduction number for a synthetic data set, validate
that the method is able to estimate the true reproduction number, and
show several checks that can be used in practice when the true
reproduction number is not known. We will also highlight other R
packages that can be used for similar analyses.</p>
</div>
<div class="section level2">
<h2 id="synthetic-data">Synthetic data<a class="anchor" aria-label="anchor" href="#synthetic-data"></a>
</h2>
<p>First, we will generate synthetic data which we will then use to
estimate the time-varying case reproduction number. To generate the
synthetic data we borrow code from <a href="https://github.com/cobeylab/Rt_estimation" class="external-link">Gostic et al.</a><span class="citation"><sup><strong>gostic2020?</strong></sup></span>.
Briefly, the synthetic data were generated from a deterministic SEIR
model in which the transmission rate changes abruptly. We will use the
synthetic time series of new infections (observed at the S→E transition)
as input into the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>R</mi><mi>t</mi><mi>c</mi></msubsup><annotation encoding="application/x-tex">R^c_t</annotation></semantics></math>
estimation method of Wallinga and Teunis. We will also test the Wallinga
and Teunis estimator using a synthetic time series of symptom onset
events, extracted daily from the E→I transition. In the synthetic data,
R0 was set to 2.0 initially, then to 0.8 and 1.15, to simulate the
adoption and, later, the partial lifting of public health interventions,
respectively.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1e6</span> <span class="co"># total population size</span></span>
<span><span class="va">n_I</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_seir_ode.html">simulate_seir_ode</a></span><span class="op">(</span></span>
<span>  arnaught <span class="op">=</span> <span class="fl">2.0</span>, </span>
<span>  t_E <span class="op">=</span> <span class="fl">4</span>, </span>
<span>  t_I <span class="op">=</span> <span class="fl">4</span>, </span>
<span>  N <span class="op">=</span> <span class="va">n</span>, </span>
<span>  S_init <span class="op">=</span> <span class="va">n</span><span class="op">-</span><span class="va">n_I</span>, </span>
<span>  E_init <span class="op">=</span> <span class="fl">0</span>, </span>
<span>  I_init <span class="op">=</span> <span class="va">n_I</span>, </span>
<span>  n_t <span class="op">=</span> <span class="fl">1000</span>, </span>
<span>  n_steps_per_t <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;   time        S         E         I         R    cum_dS   cum_dEI       dS</span></span>
<span><span class="co">#&gt; 1    0 999990.0  0.000000 10.000000  0.000000  0.000000 0.0000000       NA</span></span>
<span><span class="co">#&gt; 2    1 999985.5  3.975591  8.279842  2.255488  4.510920 0.5353295 4.510920</span></span>
<span><span class="co">#&gt; 3    2 999981.5  6.583431  7.645856  4.229408  8.458695 1.8752642 3.947775</span></span>
<span><span class="co">#&gt; 4    3 999977.7  8.490626  7.639314  6.130138 12.260078 3.7694517 3.801382</span></span>
<span><span class="co">#&gt; 5    4 999973.8 10.067141  8.013009  8.080442 16.160592 6.0934513 3.900515</span></span>
<span><span class="co">#&gt; 6    5 999969.7 11.521018  8.635804 10.157231 20.314053 8.7930352 4.153460</span></span>
<span><span class="co">#&gt;         dEI      dIR</span></span>
<span><span class="co">#&gt; 1        NA       NA</span></span>
<span><span class="co">#&gt; 2 0.5353295 2.255488</span></span>
<span><span class="co">#&gt; 3 1.3399347 1.973920</span></span>
<span><span class="co">#&gt; 4 1.8941875 1.900730</span></span>
<span><span class="co">#&gt; 5 2.3239996 1.950305</span></span>
<span><span class="co">#&gt; 6 2.6995839 2.076789</span></span></code></pre>
<div class="figure">
<img src="rt_estimation_validation_files/figure-html/plot_states-1.png" alt="Figure 1. Dynamics of an SEIR model showing the number of individuals in each state (Susceptible, Exposed, Infectious, and Recovered) over time." width="700"><p class="caption">
Figure 1. Dynamics of an SEIR model showing the number of individuals in
each state (Susceptible, Exposed, Infectious, and Recovered) over time.
</p>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">arnaught</span> <span class="op">&lt;-</span> <span class="fl">2.0</span></span>
<span><span class="va">t_E</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">t_I</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span></span>
<span><span class="co">## Calculate true case reproduction number</span></span>
<span><span class="va">Rt_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/integrate_Rt.html">integrate_Rt</a></span><span class="op">(</span></span>
<span>  beta_t <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span> <span class="va">arnaught</span> <span class="op">/</span> <span class="va">t_I</span> <span class="op">}</span>, </span>
<span>  sigma <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">t_E</span>, </span>
<span>  gamma <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">t_I</span>, </span>
<span>  N <span class="op">=</span> <span class="fl">1</span>, </span>
<span>  T_final <span class="op">=</span> <span class="fl">300</span>, </span>
<span>  E0 <span class="op">=</span> <span class="fl">0.001</span>, </span>
<span>  I0 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span> </span>
<span><span class="co">## Calculate Rt with WT method using mitey and symptom onset data from simulated data</span></span>
<span><span class="va">df_sim</span> <span class="op">&lt;-</span> <span class="va">sim_data</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">time</span>, <span class="va">dEI</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span>onset_date <span class="op">=</span> <span class="va">time</span>,</span>
<span>         inc <span class="op">=</span> <span class="va">dEI</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rt_estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rt_estim.html">rt_estim</a></span><span class="op">(</span><span class="va">df_sim</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span>, mean_si <span class="op">=</span> <span class="fl">8</span>, sd_si <span class="op">=</span> <span class="fl">5.66</span>, dist_si <span class="op">=</span> <span class="st">"gamma"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="real-data">Real data<a class="anchor" aria-label="anchor" href="#real-data"></a>
</h2>
<p>When estimating
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
in practice, it is impossible to know the underlying true
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>;
however there are a few checks that can be used to help ensure your
estimates make sense. We will use data on weekly scabies cases in the
Netherlands from 2011 to 2023 as our real data set. Below is a peak at
the data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># si dist parameters</span></span>
<span><span class="va">si_mean</span> <span class="op">&lt;-</span> <span class="fl">123.24</span></span>
<span><span class="va">si_sd</span> <span class="op">&lt;-</span> <span class="fl">31.55</span></span>
<span></span>
<span><span class="co"># Calculate the initial R_t</span></span>
<span><span class="va">rt_estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rt_estim.html">rt_estim</a></span><span class="op">(</span><span class="va">df_real</span>, mean_si <span class="op">=</span> <span class="va">si_mean</span>, sd_si <span class="op">=</span> <span class="va">si_sd</span>, dist_si <span class="op">=</span> <span class="st">"normal"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a little data wrangling</span></span>
<span><span class="va">rt_estimates1</span> <span class="op">&lt;-</span> <span class="va">rt_estimates</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.nan</a></span><span class="op">(</span><span class="va">rt</span><span class="op">)</span>,</span>
<span>         <span class="va">onset_date</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">onset_date</span><span class="op">)</span> <span class="op">+</span> <span class="fl">123</span>, <span class="co"># trim first serial interval</span></span>
<span>         <span class="va">onset_date</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">onset_date</span><span class="op">)</span> <span class="op">-</span> <span class="fl">123</span>  <span class="co"># trim last serial interval</span></span>
<span>         <span class="op">)</span></span></code></pre></div>
<p>Checks for sense-checking estimates of the reproduction number: 1.
Growth rate method: calculate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>=</mo><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>+</mo><mi>u</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">R_t = b(t+u)/b(t)</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">b()</annotation></semantics></math>
is the incidence, t is the current time point, and u is the mean
generation time (here, approximated with the mean serial interval).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># 1. Calculate b(t+u)/b(t) where b() is the incidence, t is the current time</span></span>
<span><span class="co">#    point, and u is the mean SI</span></span>
<span><span class="va">seq1</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_real</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">seq2</span> <span class="op">&lt;-</span> <span class="va">seq1</span> <span class="op">+</span> <span class="fl">123</span></span>
<span><span class="va">rt_check1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  onset_date <span class="op">=</span> <span class="op">(</span><span class="va">seq1</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">onset_date</span><span class="op">)</span>,</span>
<span>  rt_check1 <span class="op">=</span> <span class="va">df_real</span><span class="op">$</span><span class="va">inc</span><span class="op">[</span><span class="va">seq2</span><span class="op">]</span><span class="op">/</span><span class="va">df_real</span><span class="op">$</span><span class="va">inc</span><span class="op">[</span><span class="va">seq1</span><span class="op">]</span></span>
<span><span class="op">)</span> </span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Calculate the geometric mean of the time series of time-varying
reproduction number. The geometric mean should be
~<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mn>0</mn></msub><annotation encoding="application/x-tex">R_0</annotation></semantics></math>.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 2. Calculate geometric mean</span></span>
<span><span class="co"># This should be approx R0 = 1.1</span></span>
<span><span class="va">rt_check2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">rt_estimates1</span><span class="op">$</span><span class="va">rt</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rt_check2</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Use a different R package to check that estimates are similar, here
we will use the implementation of the Wallinga and Teunis method from
<code>EpiEstim</code>.</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3. Calculate rt using EpiEstim</span></span>
<span></span>
<span><span class="co"># set-up before Rt estimation</span></span>
<span><span class="co"># use discritized normal distribution</span></span>
<span><span class="va">discretize_normal</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mean</span>, <span class="va">sd</span>, <span class="va">lower</span>, <span class="va">upper</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">bins</span> <span class="op">&lt;-</span> <span class="va">lower</span><span class="op">:</span><span class="va">upper</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bins</span>, <span class="cn">Inf</span><span class="op">)</span>, <span class="va">mean</span>, <span class="va">sd</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Probabilities for each bin</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">probs</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">distr_si</span> <span class="op">&lt;-</span> <span class="fu">discretize_normal</span><span class="op">(</span>mean <span class="op">=</span> <span class="va">si_mean</span>, sd <span class="op">=</span> <span class="va">si_sd</span>, lower <span class="op">=</span> <span class="fl">0</span>, upper <span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define time windows over which to calculate Rt</span></span>
<span><span class="va">window</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">ts</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="va">ts</span> <span class="op">&lt;-</span> <span class="va">ts</span><span class="op">[</span><span class="va">ts</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">ts</span> <span class="op">&lt;=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span><span class="op">-</span><span class="va">window</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">te</span> <span class="op">&lt;-</span> <span class="va">ts</span><span class="op">+</span><span class="op">(</span><span class="va">window</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define config option </span></span>
<span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu">make_config</span><span class="op">(</span>incid <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">inc</span>,</span>
<span>                      si_distr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">distr_si</span><span class="op">)</span>,</span>
<span>                      t_start <span class="op">=</span> <span class="va">ts</span>,</span>
<span>                      t_end <span class="op">=</span> <span class="va">te</span><span class="op">)</span></span>
<span><span class="va">config</span><span class="op">$</span><span class="va">n_sim</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="co"># estimate Rt using WT method</span></span>
<span><span class="va">rt_epiestim</span> <span class="op">&lt;-</span> <span class="fu">wallinga_teunis</span><span class="op">(</span></span>
<span>  incid <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">inc</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"non_parametric_si"</span>,</span>
<span>  config <span class="op">=</span> <span class="va">config</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rt_check3</span> <span class="op">&lt;-</span> <span class="va">rt_epiestim</span><span class="op">$</span><span class="va">R</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>onset_date <span class="op">=</span> <span class="va">t_start</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">df_real</span><span class="op">$</span><span class="va">onset_date</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">onset_date</span>, <span class="va">`Mean(R)`</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s have a look by plotting the different methods to estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
together.</p>
<pre class="rt_check_plot"><code><span><span class="co"># plot checks</span></span>
<span><span class="va">df_check</span> <span class="op">&lt;-</span> <span class="va">rt_estimates1</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">onset_date</span>, <span class="va">rt</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, <span class="va">rt_check1</span>, by <span class="op">=</span> <span class="st">"onset_date"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, <span class="va">rt_check3</span>, by <span class="op">=</span> <span class="st">"onset_date"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="va">onset_date</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>    <span class="fu">case_when</span><span class="op">(</span></span>
<span>      <span class="va">name</span> <span class="op">==</span> <span class="st">"rt"</span> <span class="op">~</span> <span class="st">"WT (mitey)"</span>,</span>
<span>      <span class="va">name</span> <span class="op">==</span> <span class="st">"Mean(R)"</span> <span class="op">~</span> <span class="st">"WT (EpiEstim)"</span>,</span>
<span>      <span class="va">name</span> <span class="op">==</span> <span class="st">"rt_check1"</span> <span class="op">~</span> <span class="st">"Growth Rate"</span></span>
<span>    <span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Growth Rate"</span>, <span class="st">"WT (mitey)"</span>, <span class="st">"WT (EpiEstim)"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">p_check</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_check</span>,</span>
<span>                  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">onset_date</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">rt_check2</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Compare Methods To Estimate Rt"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Onset Date"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Daily Reproduction Number"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Method"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p_check</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kylie Ainslie.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
