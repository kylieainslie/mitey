---
title: "Validation of time-varying reproduction number estimation"
author: "Kylie Ainslie"
date: "`r Sys.Date()`"
bibliography: references.bib
csl: nature.csl
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo = FALSE, message=FALSE, results='hide'}
library(tidyr)
library(dplyr)
library(devtools)
load_all()
```

# Introduction
The `mitey` package is a lightweight package designed as a companion to the analyses presented by Ainsie et al. on scabies transmission. However, these methods are more widely applicable than in the context of scabies. One of the key functionality of `mitey` is the estimation of the time-varying case reproduction number using data on time of symptom onset. The case reproduction number is defined as the average number of new infections that an individual who becomes infected, or symptomatic, at a particular time point will go on to cause [@gostic2020], and is useful in retrospective analyses such as the one presented here. The method of Wallinga and Teunis estimates the time-varying case reproduction number by determining the likelihood of an event occurring for every pair of time points [@wallinga2007]. The method requires the specification of the serial interval distribution. In this article, we will demonstrate how to use `mitey` to estimate the case reproduction number for a synthetic data set and several checks that can be used in practice when the true reproduction number is not known.

# Synthetic data
To generate the synthetic data we borrow code from [Gostic et al.](https://github.com/cobeylab/Rt_estimation) [@gostic2020]. Briefly, synthetic data were from a deterministic SEIR model in which the transmission rate changes abruptly. Results were similar whether data were generated using a deterministic or stochastic model. For simplicity, we show deterministic outputs throughout the document, except in the section on smoothing windows, where stochasticity is a conceptual focus. A synthetic time series of new infections (observed at the S→E transition) was input into the Rt estimation methods of Wallinga and Teunis, Cori and colleagues, and Bettencourt and Ribeiro [13–15]. Following the published methods, we also tested the Wallinga and Teunis estimator using a synthetic time series of symptom onset events, extracted daily from the E→I transition. In the synthetic data, the generation interval followed a gamma distribution with shape 2 and rate of , which is the sum of exponentially distributed residence times in compartments E and I, each with a mean of 4 days [20]. In the synthetic data, R0 was set to 2.0 initially, then to 0.8 and 1.15, to simulate the adoption and later the partial lifting of public health interventions. To mimic estimation in real time, we truncated the time series at t = 150, before the end of the epidemic. 

```{r simulate data}
sim_data <- simulate_seir_ode(
  arnaught = 2.0, 
  t_E = 4, 
  t_I = 4, 
  N = 1e6, 
  S_init = N-10, 
  E_init = 0, 
  I_init = 10, 
  n_t = 1000, 
  n_steps_per_t = 10
  )
```
